# 宝寓民宿管理系统 (PMS) 产品需求文档

| 文档版本 | V1.1 |
| :--- | :--- |
| **产品名称** | 宝寓 PMS (Baoyu PMS) |
| **产品定位** | 最懂民宿房东的移动端管理神器；基于微信生态的房态、渠道、营销一体化平台 |
| **核心用户** | 城市民宿房东、乡村客栈老板、小型酒店管理者 |
| **解决痛点** | 多平台切号繁琐、房态不同步导致撞单、人工对账难、私域获客转化低 |

---

## 1. 产品架构图 (Architecture)

```mermaid
graph TD
    User[用户终端: App / 微信小程序 / 公众号 / Web管理端] --> Gateway[API 网关]
    
    subgraph "核心业务中台"
        direction TB
        Calendar[房态日历中心]
        Channel[渠道直连引擎]
        Order[订单处理系统]
        CRM[微店与会员系统]
        Finance[财务与报表]
        Rule[规则配置引擎]
    end
    
    subgraph "第三方接口层"
        OTA[OTA 接口: 携程/美团/Airbnb/途家/飞猪]
        Lock[智能门锁接口 (规划)]
        Payment[微信支付/支付宝]
        Notify[微信模板消息]
    end
    
    Gateway --> Calendar
    Gateway --> Channel
    Gateway --> Order
    Gateway --> CRM
    Gateway --> Finance
    Gateway --> Rule
    
    Channel <--> OTA
    CRM <--> Payment
    Order --> Notify
    Rule --> Calendar
```

---

## 2. 核心业务流程 (Core Workflows)

### 2.1 全渠道自动落单与关房流程 (防撞单核心)
这是系统最核心的价值，确保“一处预订，全网关房”。

1.  **触发**：客人在 Airbnb 下单预订 A 房间。
2.  **同步**：宝寓通过 API 轮询或 Webhook 实时捕获该订单。
3.  **落单**：系统自动在“房态日历”中创建订单，锁定该时间段库存。
4.  **分发**：渠道引擎立即向途家、美团、携程等其他已绑定平台发送“关房”指令。
5.  **通知**：房东微信收到“新订单提醒”，无需人工干预。

### 2.2 微店私域预订流程
1.  **分享**：房东将“宝寓微店”房源链接分享至微信群/朋友圈。
2.  **预订**：老客点击链接，查看房态（实时），选择日期下单。
3.  **支付**：调用微信支付完成交易（0 佣金或低费率）。
4.  **入住**：系统自动发送“入住指南”（含门锁密码、WiFi、定位）。
5.  **登记**：客人在线上传身份证，完成合规登记。

---

## 3. 详细功能需求 (Functional Requirements)

### 3.1 平台授权与绑定 (Platform Authorization)
**优先级：P0**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **OTA 账号授权** | 支持输入各 OTA 平台（携程、美团等）账号，完成授权回调。 | 前端提供平台选择列表，点击后跳转 OTA 授权页（OAuth2.0）；授权成功后自动跳转回“绑定成功”页。 |
| **绑定管理** | 展示已绑定平台列表，支持解绑、重新授权。 | 状态实时更新（已连接/未连接/授权过期）；解绑需二次确认。 |

### 3.2 房源映射 (Room Mapping)
**优先级：P0**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **可视化映射** | 将商家自有房源与各平台房源进行一一匹配。 | 左右分栏设计：左侧系统房源，右侧平台房源（从接口拉取）；支持拖拽匹配。 |
| **批量导入** | 支持 Excel 模板上传进行批量匹配。 | 提供标准模板下载；上传后自动解析并建立映射关系。 |
| **映射状态管理** | 提供“映射状态”筛选（已匹配 / 未匹配）。 | 只有建立映射的房源才进行库存/价格同步。 |

### 3.3 房态与订单同步 (Sync Engine)
**优先级：P0**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **聚合日历视图** | 以日历形式展示所有房源的库存状态（可售/已售/锁定）。 | 支持手动修改房态，修改后触发“同步至所有平台”接口；WebSocket 实时推送房态变化。 |
| **多平台订单管理** | 实时展示多平台订单，支持按平台、时间、状态筛选。 | 表格展示核心信息（来源、房型、入住时间、金额）；大数据列表采用虚拟滚动优化性能。 |
| **实时同步** | 订单/房态变更通过 WebSocket 实时推送到前端。 | 无需手动刷新页面即可看到最新状态。 |

### 3.4 规则配置 (Rule Configuration)
**优先级：P1**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **智能关房** | 设置自动化关房规则。 | 例如：“剩余房间数 = 0 时，自动关闭所有平台对应房型”。 |
| **价格规则** | 设置动态调价规则。 | 例如：“周五/周六房价上浮 20%”、“连住 3 晚减 100 元”。支持启用/禁用/编辑规则。 |

### 3.5 数据统计 (Data Analytics)
**优先级：P1**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **营收分析** | 多平台订单汇总、营收趋势分析。 | 柱状图/折线图展示每日/每周/每月营收；支持按平台拆分查看。 |
| **销量排行** | 房源销量、入住率排行。 | 饼图展示各渠道订单占比；列表展示热销房源。 |

### 3.6 客户服务与微店 (CRM & Direct Booking)
**优先级：P1**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **微官网/微店** | 自动生成 H5 订房页面，展示房源图文。 | 界面美观，加载速度快，支持微信一键转发。 |
| **智能入住指南** | 预设入住指引模板（图文、视频、地图）。 | 订单生成后自动触发发送（短信或微信链接）。 |
| **在线身份登记** | 引导客人上传身份证照片。 | 需符合当地公安旅业系统对接要求（如有）。 |

### 3.7 运营与房务 (Operations)
**优先级：P1**

| 功能点 | 详细描述 | 验收标准 |
| :--- | :--- | :--- |
| **保洁管理** | 房态变更为“脏房”时自动通知保洁阿姨。 | 支持保洁员小程序端接单、反馈打扫完成。 |
| **财务报表** | 自动生成各渠道对账单。 | 区分已结/未结款项，支持导出 Excel。 |

---

## 4. 前端核心技术要求
- **状态管理**：使用 Pinia/Vuex 管理全局状态（已绑定平台、选中房源、用户权限）。
- **权限控制**：基于 RBAC 模型，不同角色（管理员、操作员）展示不同菜单。
- **性能优化**：大数据列表（订单、日志）采用虚拟滚动，避免卡顿。

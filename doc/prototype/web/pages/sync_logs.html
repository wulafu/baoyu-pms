<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>宝寓 PMS - 直连同步日志</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .log-container { display: flex; height: 100vh; background: #1e1e1e; color: #ddd; font-family: 'Menlo', 'Monaco', 'Courier New', monospace; overflow: hidden; }
        .log-sidebar { width: 250px; background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-header { padding: 16px; font-weight: bold; color: #fff; border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
        .sidebar-menu { flex: 1; overflow-y: auto; padding: 10px 0; }
        .menu-item { padding: 10px 20px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; font-size: 13px; }
        .menu-item:hover { background: #2a2d2e; }
        .menu-item.active { background: #37373d; color: #fff; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-ok { background: #4caf50; }
        .status-warn { background: #ff9800; }
        .status-err { background: #f44336; }
        
        .log-main { flex: 1; display: flex; flex-direction: column; }
        .log-toolbar { height: 50px; background: #2d2d2d; border-bottom: 1px solid #333; display: flex; align-items: center; padding: 0 20px; gap: 16px; }
        .log-content { flex: 1; overflow-y: auto; padding: 20px; font-size: 13px; line-height: 1.6; }
        
        .log-entry { margin-bottom: 8px; border-left: 3px solid transparent; padding-left: 10px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        .log-entry.info { border-left-color: #2196f3; }
        .log-entry.success { border-left-color: #4caf50; }
        .log-entry.error { border-left-color: #f44336; background: rgba(244, 67, 54, 0.1); }
        .timestamp { color: #888; margin-right: 10px; }
        .module { color: #569cd6; font-weight: bold; margin-right: 10px; }
        .method { color: #c586c0; margin-right: 10px; }
        
        .back-btn { padding: 6px 12px; background: #0e639c; color: #fff; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; font-size: 12px; }
        .back-btn:hover { background: #1177bb; }
        
        .stat-badge { background: #333; padding: 2px 6px; border-radius: 4px; font-size: 11px; }
    </style>
</head>
<body>

    <div class="log-container">
        <div class="log-sidebar">
            <div class="sidebar-header">
                <span>直连监控中心</span>
                <span class="status-dot status-ok"></span>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active">
                    <span><i class="fab fa-airbnb"></i> Airbnb</span>
                    <span class="status-dot status-ok"></span>
                </div>
                <div class="menu-item">
                    <span><i class="fas fa-tripadvisor"></i> Ctrip</span>
                    <span class="status-dot status-ok"></span>
                </div>
                <div class="menu-item">
                    <span><i class="fas fa-cat"></i> Meituan</span>
                    <span class="status-dot status-warn"></span>
                </div>
            </div>
            <div style="padding: 16px; border-top: 1px solid #333; font-size: 12px; color: #888;">
                <div>上次同步: <span id="lastSyncTime">刚刚</span></div>
                <div>请求成功率: 99.8%</div>
            </div>
        </div>
        
        <div class="log-main">
            <div class="log-toolbar">
                <a href="channels.html" class="back-btn"><i class="fas fa-arrow-left"></i> 返回</a>
                <div style="color: #fff; font-weight: bold;">实时同步日志 (Real-time Sync Logs)</div>
                <div style="flex: 1;"></div>
                <button class="back-btn" onclick="clearLogs()"><i class="fas fa-trash"></i> 清空</button>
                <button class="back-btn" onclick="addMockLog()"><i class="fas fa-play"></i> 模拟触发</button>
            </div>
            
            <div class="log-content" id="logConsole">
                <!-- Logs will be injected here -->
            </div>
        </div>
    </div>

    <script>
        const logs = [
            { type: 'info', module: '[Scheduler]', method: 'JOB_START', msg: 'Starting inventory sync job #8821...' },
            { type: 'info', module: '[Inventory]', method: 'CALC', msg: 'Room [101] local inventory changed: 1 -> 0' },
            { type: 'info', module: '[Mapping]', method: 'LOOKUP', msg: 'Found 3 mapped channels for Room [101]' },
            { type: 'success', module: '[Airbnb]', method: 'PUSH_ARI', msg: 'POST /v2/inventory/availability | Status: 200 OK | Payload: { avail: 0 }' },
            { type: 'success', module: '[Ctrip]', method: 'PUSH_ARI', msg: 'POST /hotel/ota/update | Status: 200 OK | Response: { "RetCode": "Success" }' },
            { type: 'error', module: '[Meituan]', method: 'PUSH_ARI', msg: 'POST /api/inventory | Status: 504 Gateway Timeout | Retrying in 5s...' },
            { type: 'info', module: '[Meituan]', method: 'RETRY', msg: 'Retry attempt 1 for Meituan...' },
            { type: 'success', module: '[Meituan]', method: 'PUSH_ARI', msg: 'POST /api/inventory | Status: 200 OK | Recovered' },
            { type: 'info', module: '[Scheduler]', method: 'JOB_END', msg: 'Sync job #8821 completed in 452ms' }
        ];

        function renderLog(log) {
            const now = new Date().toISOString().split('T')[1].slice(0, 8);
            const div = document.createElement('div');
            div.className = `log-entry ${log.type}`;
            div.innerHTML = `
                <span class="timestamp">[${now}]</span>
                <span class="module">${log.module}</span>
                <span class="method">${log.method}</span>
                <span>${log.msg}</span>
            `;
            const consoleDiv = document.getElementById('logConsole');
            consoleDiv.appendChild(div);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // Initial render
        let delay = 0;
        logs.forEach(log => {
            setTimeout(() => renderLog(log), delay);
            delay += 300 + Math.random() * 500;
        });

        function clearLogs() {
            document.getElementById('logConsole').innerHTML = '';
        }

        function addMockLog() {
            const actions = ['New Order', 'Cancel Order', 'Update Price'];
            const action = actions[Math.floor(Math.random() * actions.length)];
            renderLog({ 
                type: 'info', 
                module: '[Webhook]', 
                method: 'RECV', 
                msg: `Received ${action} webhook from Airbnb. Processing...` 
            });
        }
        
        setInterval(() => {
             document.getElementById('lastSyncTime').innerText = new Date().toLocaleTimeString();
        }, 1000);
    </script>
</body>
</html>